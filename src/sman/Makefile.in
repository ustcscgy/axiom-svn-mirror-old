
subdir = src/sman/

# this is where to put the various commands
OUT=	${MNT}/${SYS}/bin
OUTLIB=	${MNT}/${SYS}/lib

# this is where the include files live
INC=    $(axiom_src_srcdir)/include

# this is where we hid the libspad library
LIB=	${OBJ}/${SYS}/lib

# this is where the documentation ends up
DOC=    ${MNT}/${SYS}/doc/src/sman
CFLAGS=	${CCF} -I$(INC) -I$(builddir)
LDFLAGS= -L${LIB} -lspad ${LDF}

SMANOBJS= ${LIB}/libspad.a


build_libdir = $(abs_top_builddir)/src/lib


session_sources = session.c
session_SOURCES = $(addsuffix .pamphlet, $(session_sources))
session_objects = $(addprefix $(builddir)/, $(session_sources:.c=.o))
session_LDADD = -L$(build_libdir) -lspad
session_DEPENDENCIES = $(build_libdir)/libspad.a

spadclient_sources = spadclient.c
spadclient_SOURCES = $(addsuffix .pamphlet, $(spadclient_sources))
spadclient_objects = $(addprefix $(builddir)/, $(spadclient_sources:.c=.o))
spadclient_LDADD = -L$(build_libdir) -lspad
spadclient_DEPENDENCIES = $(build_libdir)/libspad.a

sman_sources = sman.c
sman_SOURCES = $(addsuffix .pamphlet, $(sman_sources))
sman_objects = $(addprefix $(builddir)/, $(sman_sources:.c=.o))
sman_LDADD = -L$(build_libdir) -lspad
sman_DEPENDENCIES = $(build_libdir)/libspad.a


pamphlets = $(session_SOURCES) $(spadclient_SOURCES) $(sman_SOURCES)

all:	$(OUTLIB)/session $(OUTLIB)/spadclient $(OUT)/sman

.PRECIOUS: $(builddir)/%.o
.PRECIOUS: $(builddir)/%.c
.PRECIOUS: $(builddir)/%.h

$(builddir)/%.o: $(builddir)/%.c
	$(CC) -c $(CFLAGS) -o $@ $<

$(builddir)/%.c: $(srcdir)/%.c.pamphlet
	$(axiom_build_document) --tangle --output=$@ $<

${OUTLIB}/session: $(session_objects) $(session_DEPENDENCIES)
	$(CC) $(session_objects) -o $@ $(session_LDADD) $(LDFLAGS)

${OUTLIB}/spadclient: $(spadclient_objects) $(spadclient_DEPENDENCIES)
	$(CC) $(spadclient_objects) $(spadclient_LDADD) $(LDFLAGS)

$(builddir)/spadclient.o: ${INC}/useproto.h ${INC}/spadclient.H1

${OUT}/sman: $(sman_objects) $(sman_DEPENDENCIES)
	$(CC) $(sman_objects) $(sman_LDADD) $(LDFLAGS)

$(sman_objects): $(builddir)/sman.h

$(builddir)/sman.h: $(srcdir)/sman.c.pamphlet
	$(axiom_build_document) --tangle=sman.h --output=$@ $<

$(build_libdir)/libspad.a:
	cd $(build_libdir) && $(MAKE) $@

mostlyclean-local:

clean-local: mostlyclean-local
	-rm -f $(session_sources) $(session_objects) $(builddir)/sman.h
	-rm -f $(OUTLIB)/session
	-rm -f $(spadclient_sources) $(session_objects)
	-rm -f $(OUTLIB)/spadclient
	-rm -f $(sman_sources) $(sman_objects)
	-rm -f $(OUT)/sman

distclean-local: clean-local

