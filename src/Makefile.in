

SUBDIRS = @SRC_SUBDIRS@

clef-stamp = clef/stamp
sman-stamp = sman/stamp
hyper-stamp = hyper/stamp
share-stamp = share/stamp
book-stamp = booklets/stamp
lib-stamp = lib/stamp
boot-stamp = boot/stamp
interp-stamp = interp/stamp
alg-stamp = algebra/stamp
input-stamp = input/stamp
etc-stamp = etc/stamp
doc-stamp = doc/stamp
graph-stamp = graph/stamp


pamphlets = Makefile.pamphlet

subdir = src/

all: $(addsuffix /stamp, $(SUBDIRS))
	@echo 49 finished $(builddir)

$(clef-stamp): 
	@echo 5 making $(axiom_src_srcdir)/clef
	@ $(mkinstalldirs) ${OBJ}/${SYS}/clef
	@ $(mkinstalldirs) ${MNT}/${SYS}/doc/src/clef
	@ cd clef && ${ENV} ${MAKE}
$(sman-stamp): $(lib-stamp)
	@echo 5 making $(axiom_src_srcdir)/sman
	@ $(mkinstalldirs) ${INT}/sman
	@ $(mkinstalldirs) ${OBJ}/${SYS}/sman
	@ $(mkinstalldirs) ${MNT}/${SYS}/doc/src/sman
	@ cd sman && ${ENV} ${MAKE}
$(hyper-stamp): $(lib-stamp)
	@echo 13 making $(axiom_src_srcdir)/hyper
	@ $(mkinstalldirs) ${INT}/hyper
	@ $(mkinstalldirs) ${OBJ}/${SYS}/hyper
	@ $(mkinstalldirs) ${OBJ}/${SYS}/bin
	@ $(mkinstalldirs) ${OBJ}/${SYS}/lib
	@ $(mkinstalldirs) ${MNT}/${SYS}/doc/hypertex
	@ $(mkinstalldirs) ${MNT}/${SYS}/doc/src/hyper
	@ cd hyper && ${ENV} ${MAKE}
$(share-stamp): $(interp-stamp)
	@echo 9 making $(axiom_src_srcdir)/share
	@ $(mkinstalldirs) ${MNT}/${SYS}/doc/hypertex/pages
	@ $(mkinstalldirs) ${MNT}/${SYS}/lib
	@ cd share && ${ENV} ${MAKE}
$(doc-stamp):
	@echo 41 making ${INT}/doc
	@ $(mkinstalldirs) ${INT}/doc
	@ $(mkinstalldirs) ${MNT}/${SYS}/bin
	@ cd doc && ${ENV} ${MAKE}
$(book-stamp): 
	@echo 13 making $(axiom_src_srcdir)/booklets
	@cd booklets && ${ENV} ${MAKE}
$(lib-stamp):
	@echo 17 making $(builddir)/lib
	@$(mkinstalldirs) ${INT}/lib
	@$(mkinstalldirs) ${OBJ}/${SYS}/lib
	@$(mkinstalldirs) ${INT}/doc/src/lib
	@$(mkinstalldirs) ${MNT}/${SYS}/doc/src/lib
	@cd lib && ${ENV} ${MAKE}
$(boot-stamp): $(lib-stamp)
	@echo 21 making ${INT}/boot
	@$(mkinstalldirs) ${INT}/boot
	@$(mkinstalldirs) ${OBJ}/${SYS}/boot
	@$(mkinstalldirs) ${MNT}/${SYS}/doc/src/boot
	@cd boot && ${ENV} ${MAKE}
$(interp-stamp): $(boot-stamp)
	@echo 25 making ${INT}/interp
	@$(mkinstalldirs) ${INT}/interp
	@$(mkinstalldirs) ${INT}/algebra
	@$(mkinstalldirs) ${OBJ}/${SYS}/interp
	@$(mkinstalldirs) ${MNT}/${SYS}/autoload
	@$(mkinstalldirs) ${MNT}/${SYS}/algebra
	@$(mkinstalldirs) ${MNT}/${SYS}/doc/msgs
	@$(mkinstalldirs) ${MNT}/${SYS}/doc/src/interp
	@cd interp && ${ENV} ${MAKE}
$(alg-stamp): $(share-stamp)
	@echo 29 making $(builddir)/algebra
	@ $(mkinstalldirs) ${INT}/algebra
	@ $(mkinstalldirs) ${INT}/input
	@ $(mkinstalldirs) ${OBJ}/${SYS}/algebra
	@$(mkinstalldirs) ${MNT}/${SYS}/algebra
	@$(mkinstalldirs) ${MNT}/${SYS}/doc/src/algebra
	@$(mkinstalldirs) ${MNT}/${SYS}/src/algebra
	$(TANGLE) -t8 -RfindAlgebraFiles $(srcdir)/algebra/Makefile.pamphlet \
                  > $(INT)/algebra/findAlgebraFiles && \
	echo 30b running ${INT}/algebra/findAlgebraFiles && \
	(cd $(srcdir)/algebra && . $(INT)/algebra/findAlgebraFiles) \
          >> $(builddir)/algebra/more-rules.mk
	cd algebra && ${ENV} ${MAKE}
$(input-stamp): $(alg-stamp) $(etc-stamp) $(clef-stamp)
	@echo 33 making ${INT}/input
	@ $(mkinstalldirs) ${INT}/input
	@ $(mkinstalldirs) ${MNT}/${SYS}/input
	@ $(mkinstalldirs) ${MNT}/${SYS}/doc/src/input
	@ cd input && ${ENV} ${MAKE}
$(etc-stamp): $(alg-stamp)
	@echo 37 making ${INT}/etc
	@ $(mkinstalldirs) ${OBJ}/${SYS}/etc
	@ $(mkinstalldirs) ${MNT}/${SYS}/bin
	@ $(mkinstalldirs) ${MNT}/${SYS}/lib
	@ cd etc && ${ENV} ${MAKE}
$(graph-stamp): $(lib-stamp)
	@echo 45 making ${INT}/graph
	@ $(mkinstalldirs) ${INT}/graph/parabola
	@ $(mkinstalldirs) ${OBJ}/${SYS}/graph
	@ cd graph && ${ENV} ${MAKE}
