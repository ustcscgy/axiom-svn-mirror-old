%% Oh Emacs, this is a -*- Makefile -*-, so give me tabs.
\documentclass{article}
\usepackage{axiom}

\title{\$SPAD/src/paste Makefile}
\author{Waldek Hebisch}

\begin{document}

\maketitle

\begin{abstract}
\end{abstract}

\eject
\tableofcontents
\eject

\section{Generating [[.pht]] files and images}

The \Tool{Axiom} can precompute output and images for later use by
HyperDoc (see HyperDoc page HTXAdvPage5 and [[src/hyper/htinp.pamphlet]]).
This capability is used here to generate most [[.pht]] used by HyperDoc.

<<*>>=
subdir = src/paste/
pamphlets = Makefile.pamphlet

TAXDIR = $(axiom_targetdir)
THTDIR = $(axiom_target_datadir)/hypertex/pages
SMAN = $(axiom_target_bindir)/sman
IN=     $(axiom_src_srcdir)/input
HTADD=$(axiom_target_bindir)/htadd

# need NAG libraries
NAGPHTS = ANNA-ES ug15

# exint gives wrong results
PHTS = ALIST ARRAY1 ARRAY2 BBTREE BINARY BOP BSTREE CARD CARTEN CCLASS \
       CHAR CLIF COMPLEX CONTFRAC CYCLES DECIMAL DERHAM DFLOAT DMP \
       EQ EQTBL EXIT EXPR FARRAY FILE FLOAT FNAME FPARFRAC FR FR2 \
       FRAC GBF GSTBL HEAP HEXADEC INT INTHEORY KAFILE KERNEL LAZM3PK \
       LEXP LEXTRIPK LIB LIST LODO LODO1 LODO2 LPOLY LWORD MAGMA \
       MAPPKG1 MATRIX MKFUNC MPOLY MSET NONE OCT ODPOL OP OVAR PERMAN \
       PFR POLY QUAT RADIX RECLOS REGSET ROMAN SEG SET SINT SQMATRIX SREGSET \
       STBL STREAM STRING STRTBL SYMBOL TABLE TEXTFILE UNISEG UP \
       VECTOR VOID WUTSET XPBWPOLY XPOLY XPR ZDSOLVE ZLINDEP evalex exdiff \
       exlap exlimit exmatrix exseries exsum function grpthry \
       numbers polys ug02 ug03 ug04 ug05 ug06 ug12 ug13

GPHTS = SEGBIND explot2d coverex explot3d graphics \
        ug01 ug07 ug08 ug10 ug11

.PHONY: all nphts gphts

# Without acces to X server we can build only normal pages
all:
	(cd $(THTDIR); \
	  rm -f ht.db ; \
	  ${HTADD} *.ht)
	$(MAKE) nphts
	(cd $(THTDIR); \
	  rm -f ht.db ; \
	  ${HTADD} *.ht *.pht )

nphts: $(addprefix $(THTDIR)/, $(addsuffix .pht, $(PHTS)))

gphts: $(addsuffix .pht, $(GPHTS))

GRINPUTS = bouquet.input vectors.input arrows.input ribbon.input newton.input

ug10.pht: $(GRINPUTS)

$(GRINPUTS):  %.input : $(IN)/%.input.pamphlet
	$(axiom_build_document) --tangle --output=$@ $<

$(addprefix $(THTDIR)/, $(addsuffix .pht, $(PHTS) $(GPHTS))): \
    $(THTDIR)/%.pht : %.pht
	cp $< $@

# -noihere works around race in session
$(addsuffix .pht, $(PHTS)): %.pht : $(THTDIR)/%.ht
	(export AXIOM=$(TAXDIR); unset DAASE; $(SMAN) -noihere -paste $<)

# -noihere works around race in session
$(addsuffix .pht, $(GPHTS)): %.pht : $(THTDIR)/%.ht
	(export AXIOM=$(TAXDIR); unset DAASE; $(SMAN) -noihere -paste $<)
@
\eject
\begin{thebibliography}{99}
\bibitem{1} nothing
\end{thebibliography}
\end{document}
