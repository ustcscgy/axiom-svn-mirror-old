OUT=	${MNT}/${SYS}/lib

# local include files shared by graphics
LINC=	$(axiom_src_srcdir)/graph/include

# global include files shared by everyone
GINC=	$(axiom_src_srcdir)/include

build_libdir = $(abs_top_builddir)/src/lib


view2D_sources = buttons2d.c control2d.c graph2d.c main2d.c pot2d.c \
		process2d.c spadAction2d.c stuff2d.c viewport2D.c write2d.c

view2D_objects = $(addprefix $(builddir)/,$(view2D_sources:.c=.o))

other_objects = $(build_libdir)/hash.o
Gfun_objects = $(abs_top_builddir)/src/graph/Gdraws/Gfun.o 

view2D_LDADD = -L$(build_libdir) -lspad

view2D_DEPENDENCIES = $(build_libdir)/libspad.a $(Gfun_objects) \
			$(build_libdir)/hash.o


subdir = src/graph/view2D/

CFLAGS  = ${CCF} ${AXIOM_X11_CFLAGS} -I${LINC} -I${GINC} -I$(srcdir)
LDFLAGS = ${AXIOM_X11_LDFLAGS} -lm

GDRAW=	${OBJ}/${SYS}/graph/Gdraws

GDRAW_OBJS = ${GDRAW}/Gfun.o ${OBJ}/${SYS}/lib/hash.o

HEADERS = $(srcdir)/header2.h   $(srcdir)/globals2.h      ${LINC}/view2D.h \
          ${LINC}/actions.h ${LINC}/viewCommand.h ${GINC}/view.h   ${LINC}/G.h

all: ${OUT}/view2D
	@ echo 36 finished $(srcdir)

${OUT}/view2D: $(view2D_objects) $(view2D_DEPENDENCIES)
	${CC} $(view2D_objects) $(Gfun_objects) $(other_objects) -o $@ \
	    $(view2D_LDADD) $(LDFLAGS)

.PRECIOUS: $(builddir)/%.c
.PRECIOUS: $(builddir)/%.o

$(builddir)/%.o: $(HEADERS)

$(builddir)/%.o: $(builddir)/%.c
	${CC} -c ${CFLAGS} -o $@ $<

$(builddir)/%.c: $(srcdir)/%.c.pamphlet
	$(axiom_build_document) --tangle --output=$@ $<

$(build_libdir)/hash.o $(build_libdir)/libspad.a:
	cd $(build_libdir) && $(MAKE) $@

$(abs_top_builddir)/src/graph/Gdraws/Gfun.o:
	cd $(abs_top_builddir)/src/graph/Gdraws && $(MAKE) $@

mostlyclean-local:

clean-local: mostlyclean-local
	-rm -f $(view2D_sources) $(view2D_objects)
	-rm -f $(OUT)/view2D

distclean-local: clean-local

document: 
	@ echo 38 documenting $(srcdir)

