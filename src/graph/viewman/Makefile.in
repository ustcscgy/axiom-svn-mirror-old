OUT=	${MNT}/${SYS}/lib
LIB=    ${OBJ}/${SYS}/lib

# local include files shared by graphics
LINC=	$(axiom_src_srcdir)/graph/include

# global include files shared by everyone 
GINC=	$(axiom_src_srcdir)/include

build_libdir = $(abs_top_builddir)/src/lib

viewman_sources = cleanup.c fun2D.c fun3D.c make2D.c make3D.c \
		makeGraph.c readView.c sselect.c viewman.c

viewman_SOURCES = $(addsuffix .pamphlet, $(viewman_sources))

viewman_objects = $(viewman_sources:.c=.o)

viewman_headers = $(srcdir)/viewman.h \
		$(addprefix $(axiom_src_srcdir)/graph/include/,\
			component.h view2D.h view3D.h tube.h \
			actions.h viewCommand.h) \
		$(axiom_src_srcdir)/include/com.h


viewman_DEPENDENCIES = $(build_libdir)/libspad.a
viewman_LDFLAGS = -L$(build_libdir) -lspad

pamphlets = Makefile.pamphlet $(viewman_SOURCES)


subdir = src/graph/viewman/

CFLAGS  = ${CCF} ${AXIOM_X11_CFLAGS} -I${LINC} -I${GINC} -I$(srcdir)
LDFLAGS = ${AXIOM_X11_LDFLAGS} 

all: ${OUT}/viewman
	@ echo 30 finished $(srcdir)


.PRECIOUS: $(builddir)/%.c
.PRECIOUS: $(builddir)/%.o

$(builddir)/%.o: $(viewman_HEADERS)

$(builddir)/%.o: $(builddir)/%.c
	$(CC) $(CFLAGS) -c -o $@ $<

$(builddir)/%.c: $(srcdir)/%.c.pamphlet
	$(axiom_build_document) --tangle --output=$@ $<

$(OUT)/viewman: $(viewman_objects) $(viewman_DEPENDENCIES)
	${CC} $(viewman_objects) -o $@ $(viewman_LDFLAGS) ${LDFLAGS}

$(build_libdir)/libspad.a:
	cd $(build_libdir) && $(MAKE) $@

mostlyclean-local:

clean-local: mostlyclean-local
	-rm -f $(viewman_sources) $(viewman_objects)
	-rm -f $(OUT)/viewman

distclean-local: clean-local

