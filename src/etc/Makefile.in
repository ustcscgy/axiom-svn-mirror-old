IN=${SRC}/etc
MID=${OBJ}/${SYS}/etc
OUT=${MNT}/${SYS}/bin
LIB=${MNT}/${SYS}/lib
DOC=${INT}/doc/src/etc
INTERPSYS=${OBJ}/${SYS}/bin/interpsys

subdir = src/etc/

all: ${MNT}/${SYS}/algebra/*.daase ${OUT}/asq ${LIB}/summary \
     ${LIB}/copyright ${OUT}/axiom
	@echo 6 finished $(builddir)
	-rm -f stamp
	$(STAMP) stamp

${MNT}/${SYS}/algebra/*.daase: ${INT}/algebra/*.NRLIB/code.o
	@ echo 4 rebuilding databases...
	@ cp $(axiom_src_docdir)/gloss.text ${INT}/algebra
	@ cp $(axiom_src_docdir)/gloss.text ${INT}/algebra
	@ cp $(axiom_src_docdir)/topics.data ${INT}/algebra
	@ cp $(axiom_src_docdir)/topics.data ${INT}/algebra
	@ (cd ${INT}/algebra ; \
           echo ')lisp (make-databases "" nil)' | ${INTERPSYS} )
	@ cp ${INT}/algebra/*.daase ${MNT}/${SYS}/algebra

${OUT}/asq: ${MID}/asq.c
	@echo 4 making ${OUT}/asq from ${MID}/asq.c
	@( cd ${MID} ; ${CC} ${CCF} -o asq asq.c )
	@cp ${MID}/asq ${OUT}

${MID}/asq.c: $(srcdir)/asq.c.pamphlet
	$(axiom_build_document) --tangle --output=$@ $<
${LIB}/summary: $(srcdir)/summary
	$(INSTALL_DATA) $< $@ 

${LIB}/copyright: $(srcdir)/copyright
	$(INSTALL_DATA) $< $@ 

${OUT}/axiom: $(srcdir)/axiom
	@echo 1 making $@ from $<
	@ $(INSTALL_SCRIPT) $< $@
	@chmod +x ${OUT}/axiom

document: $(srcdir)/asq.c.pamphlet
	$(axiom_build_document) --weave --latex $< $(SINK_NOISE)
	$(INSTALL_DATA) asq.c.dvi $(DOC)

clean:
	@echo 8 cleaning $(builddir)
	@rm -rf ${MID}
	@rm -rf ${DOC}
	@rm -f Makefile Makefile.dvi

