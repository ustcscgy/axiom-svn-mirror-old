\documentclass{article}
\usepackage{axiom}
\begin{document}
\title{\$SPAD/src/doc Makefile}
\author{Timothy Daly}
\maketitle
\begin{abstract}
\end{abstract}
\eject
\tableofcontents
\eject
\section{The bibtex stanza}
Axiom pamphlet files have citations. We collect all of the 
pamphlet file citations into this one file so we have a standard
place and format for bibliographic references.

Citations of pamphlet files which are local are generally by
the name. For example, [[asq.c.pamphlet]] would be cited using
[[\cite{asq.c}]].
<<bibtex>>=
${MID}/axiom.bib: ${IN}/axiom.bib.pamphlet
	@echo 1 making ${MID}/axiom.bib from ${IN}/axiom.bib.pamphlet
	@ (cd ${MID} ; \
	 ${TANGLE} ${IN}/axiom.bib.pamphlet >${MID}/axiom.bib )

@ 
\section{The axiom.sty stanza}
Axiom uses a style file that is a modified version of the noweb.sty
originally written by Norman Ramsey. To this we've added macros to
support the CATS (Computer Algebra Test Suite).
<<axiom.sty>>=
${STY}/axiom.sty: ${IN}/axiom.sty.pamphlet
	@echo 2 making ${STY}/axiom.sty from ${IN}/axiom.sty.pamphlet
	@(cd ${STY} ; \
	${TANGLE} -R"axiom.sty" ${IN}/axiom.sty.pamphlet >axiom.sty )

@ 
\section{Book Volume 4: Developer Notes}
This file contains a random collection of facts about Axiom
intended for developers. It talks about directory structure,
internal representations, debugging tools, and gives a cookbook
for using CVS. There is nothing of interest for the end user.
<<bookvol4>>=
${DVI}/bookvol4.dvi: ${IN}/bookvol4.pamphlet ${STY}/axiom.sty
	@echo 3 making ${DVI}/bookvol4.dvi from ${IN}/bookvol4.pamphlet
	@(cd ${MID} ; \
	cp ${IN}/bookvol4.pamphlet ${MID} ; \
	${DOCUMENT} ${NOISE} bookvol4 ; \
	cp bookvol4.dvi ${DVI} )

@
\section{Book}
This file contains the main documentation for Axiom, the Axiom book.
We take care to copy the whole [[ps/]] directory that contains images
used by the book.
<<Book>>=
${DVI}/book.dvi: ${IN}/book.pamphlet
	@echo 4 making ${DVI}/book.dvi from ${IN}/book.pamphlet
	@(cd ${MID} ; \
	cp ${IN}/book.pamphlet ${MID} ; \
	mkdir -p ${MID}/ps ; \
	cp ${IN}/ps/*ps* ${MID}/ps ; \
	${DOCUMENT} ${NOISE} book ; \
	cp book.dvi ${DVI} ; \
	mkdir -p ${DVI}/ps ; \
	cp ${IN}/ps/*ps* ${DVI}/ps )

@
\section{Book Volume 1: Tutorial}
This is the tutorial volume, the first book in the new axiom series.
<<bookvol1>>=
${DVI}/bookvol1.dvi: ${IN}/bookvol1.pamphlet
	@echo 4 making ${DVI}/bookvol1.dvi from ${IN}/bookvol1.pamphlet
	@(cd ${MID} ; \
	cp ${IN}/bookvol1.pamphlet ${MID} ;\
	mkdir -p ${MID}/ps ; \
	cp ${IN}/ps/*ps* ${MID}/ps ; \
	${DOCUMENT} ${NOISE} bookvol1 ; \
	cp bookvol1.dvi ${DVI} ; \
	mkdir -p ${DVI}/ps ; \
	cp ${IN}/ps/*ps* ${DVI}/ps )

@
\section{The End Papers}
This document reproduces the diagrams on the inside covers of the
original Jenks Axiom book but adds hyperlinks.
<<Endpapers>>=
${DVI}/endpaper.dvi: ${IN}/endpaper.pamphlet
	@echo 4 making ${DVI}/endpaper.dvi from ${IN}/endpaper.pamphlet
	@(cd ${MID} ; \
	cp ${IN}/endpaper.pamphlet ${MID} ; \
	mkdir -p ${MID}/ps ; \
	cp ${IN}/ps/*ps* ${MID}/ps ; \
	${DOCUMENT} ${NOISE} endpaper ; \
	cp endpaper.dvi ${DVI} ; \
	mkdir -p ${DVI}/ps ; \
	cp ${IN}/ps/*ps* ${DVI}/ps )

@
\section{rosetta}
The rosetta document is an effort to give a command-by-command
way of moving between various computer algebra systems. It was
originally created for the "rosetta" series of CDs. These rosetta
CDs contained multiple, free computer algebra systems.
<<rosetta>>=
${DVI}/rosetta.dvi: ${IN}/rosetta.pamphlet
	@echo 5 building ${DVI}/rosetta.dvi from ${IN}/rosetta.pamphlet
	@(cd ${MID} ; \
	cp ${IN}/rosetta.pamphlet ${MID} ; \
	${DOCUMENT} ${NOISE} rosetta ; \
	cp rosetta.dvi ${DVI} )

@
\section{The booklet command}
<<booklet>>=
${OUT}/booklet: ${MID}/booklet.o
	@echo 6 making ${OUT}/booklet from ${MID}/booklet.o
	@(cd ${OUT} ; \
	  ${CC} ${MID}/booklet.o -o booklet )

${MID}/booklet.o: ${INT}/booklet.c
	@echo 7 making ${MID}/booklet.o from ${INT}/booklet.c
	@(cd ${MID} ; \
	  ${CC} -c ${INT}/booklet.c )

${INT}/booklet.c: ${IN}/booklet.c.pamphlet
	@echo 8 making ${INT}/booklet.c from ${IN}/booklet.c.pamphlet
	@(cd ${INT} ; \
	  ${TANGLE} ${IN}/booklet.c.pamphlet >booklet.c )
	  
@
\section{The )help files}
<<helpspad>>=
HELPSPAD=abbreviation boot cd clear close compile display edit fin frame \
         help history \
         language library lisp load ltrace \
         nclef pquit quit read \
         savesystem set show spool synonym system trace undo what

@
<<helpspad.files>>=
${DVI}/spadhelp/helpspad.files: ${IN}/spadhelp.pamphlet
	@echo 9 making ${DVI}/spadhelp from ${IN}/spadhelp.pamphlet
	@mkdir ${DVI}/spadhelp
	@(cd ${DVI}/spadhelp ; \
          for i in ${HELPSPAD} ; do \
            ${TANGLE} -R"$$i" ${IN}/spadhelp.pamphlet >$$i.help ; \
          done ; \
          ls *.help >helpspad.files )

@
\section{The Makefile}
We need to document the commands.
<<*>>=
IN=${SRC}/doc
MID=${INT}/doc
OUT=${MNT}/${SYS}/bin
STY=${OUT}/tex
DVI=${MNT}/${SYS}/doc
DOC=${INT}/doc

FILES= ${MID}/axiom.bib ${STY}/axiom.sty ${DVI}/bookvol4.dvi \
       ${DVI}/book.dvi ${DVI}/bookvol1.dvi ${DVI}/endpaper.dvi \
       ${DVI}/rosetta.dvi ${DVI}/spadhelp/helpspad.files

CMDS=${OUT}/booklet

<<helpspad>>

all: ${FILES} ${CMDS}
	@echo 9 finished ${IN}

<<booklet>>
<<bibtex>>
<<axiom.sty>>
<<bookvol4>>
<<Book>>
<<bookvol1>>
<<Endpapers>>
<<rosetta>>
<<helpspad.files>>


document:
	@echo 10 documenting ${SRC}/doc

clean:
	@echo 11 cleaning ${SRC}/doc
@
\eject
\begin{thebibliography}{99}
\bibitem{1} nothing
\end{thebibliography}
\end{document}
